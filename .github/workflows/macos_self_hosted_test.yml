name: macOS Self-Hosted Test

on:
  workflow_dispatch:
  push:

jobs:
  test-clickhouse-connectivity:
    name: Test ClickHouse Connectivity
    runs-on: [ self-hosted, apple ]

    steps:
      - name: Install Clickhouse CLI
        run: |
          curl https://clickhouse.com/ | sh
          sudo ./clickhouse install

      - name: Connect to ClickHouse
        run: clickhouse-client --no-warnings -m -n --user dev-rw -h clickhouse.duckduckgo.com -q "DESCRIBE TABLE native_apps.macos_performance_memory_test_results"

      # - name: Test ClickHouse HTTP port (8123)
      #   run: nc -zv clickhouse.duckduckgo.com 8123

      # - name: Test ClickHouse Native port (9000)
      #   run: nc -zv clickhouse.duckduckgo.com 9000
