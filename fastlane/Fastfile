import("../iOS/fastlane/Fastfile")
import("../macOS/fastlane/Fastfile")

lane :update_dependencies do
  Dir.chdir("../SharedPackages/BrowserServicesKit") do
    sh('swift package update')
  end

  Dir.chdir("../SharedPackages/DataBrokerProtectionCore") do
    sh('swift package update')
  end

  Dir.chdir("../iOS") do
    sh('xcodebuild -resolvePackageDependencies')
  end

  Dir.chdir("../macOS") do
    sh('xcodebuild -resolvePackageDependencies')
  end

  Dir.chdir("..") do
    sh('xcodebuild -resolvePackageDependencies')
  end
end

lane :fetch_content_scope_scripts do
  script_path = File.join(__dir__, "..", "SharedPackages", "BrowserServicesKit", "scripts", "fetch-content-scope-scripts.sh")

  # Check if script exists
  unless File.exist?(script_path)
    UI.user_error!("Script file not found at: #{script_path}")
  end

  UI.message("Fetching content-scope-scripts...")
  UI.message("Reading configuration from content-scope-scripts-config.json")

  # Execute the script (it reads config internally)
  sh(script_path)

  UI.success("âœ… Content-scope-scripts fetched successfully!")
end
